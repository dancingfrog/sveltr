---
title: GLSL Shaders
author: John
date: '2020-04-01'
draft: false
categories:
  - GL
tags:
  - GL
  - Svelte
  - SvelteGL
  - WebGL
---

<div id="glsl-app"></div>

## Shaders

```{r setup, include=FALSE}
options(warn = -1)
working_dir <- getwd()
print(working_dir)
if (!require("knitr")) {
    install.packages("knitr")
    library("knitr")
}
knitr::opts_chunk$set(cache = TRUE)
knitr::opts_chunk$set(echo = TRUE)

# Load reticulate package for running python
if (!require("png")) {
    install.packages("png")
}
library(png)
```

ESSL 3.00 provides two types of constants (*uniform* and *attribute*) and one type of variable (*varying*). The scope of a *uniform* (`uniform`) is global, available to all shaders in the program, while the scope of an *attribute* (`in`) is limited to the shader in which it is defined. The scope of a *varying* (`in` and `out`) bridges the shader in which it is defined and initialized with the shader in which it is received. There are multiple classes (*storage qualifiers*) available for uniforms, attributes and varyings, like:

    vec3
    vec4
    mat4


There are also multiple levels of precision:

    lowp
    mediump

To create custom shaders for use with `@svelte/gl`, I had to make some changes to the `gl` source, beginning add a declaration to all shaders compile by `Material.mjs`:

        const { program, uniforms, attributes } = compile(
			gl,
			'#version 300 es' + '\n\n' + scene.defines + defines + '\n\n' + vert_builtin + '\n\n' + vert,
			'#version 300 es' + '\n\n' + scene.defines + defines + '\n\n' + frag_builtin + '\n\n' + frag
		);

Updating the shader version to 3.00 also required all attributes and varyings in the existing shaders to be re-declared using the new syntax. For example, what used to say:

    attribute vec3 position;
    attribute vec3 normal;

... had to be changed to say:

    in vec3 position;
    in vec3 normal;

The final output var in the fragment shader also had to be changed, as the gl_FragColor builtin was no longer valid:

    out mediump vec4 fragColor;
    ...

    #elif defined(has_color)
	fragColor = vec4(color, 1.0);
	#endif

	#ifdef has_alpha
	fragColor.a *= alpha;
	#endif

	fragColor.rgb *= mix(AMBIENT_LIGHT, vec3(1.0, 1.0, 1.0), lighting);
	fragColor.rgb += spec_amount;

With these changes in place I can now use all of the latest shader features within GL-powered Sveltr apps and pages.
